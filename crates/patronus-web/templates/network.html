<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network - Patronus</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .stat-card { border: 1px solid #ddd; padding: 15px; margin: 10px; border-radius: 5px; }
        .badge { padding: 3px 8px; border-radius: 3px; font-size: 0.8em; }
        .badge.success { background: #28a745; color: white; }
        .badge.info { background: #17a2b8; color: white; }
        .badge.warning { background: #ffc107; color: black; }
        .badge.danger { background: #dc3545; color: white; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .btn { padding: 6px 12px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; }
        .btn.btn-primary { background: #007bff; color: white; }
        .btn.btn-secondary { background: #6c757d; color: white; }
        .btn.btn-success { background: #28a745; color: white; }
        .btn.btn-warning { background: #ffc107; color: black; }
        .btn.btn-danger { background: #dc3545; color: white; }
        .btn-sm { padding: 4px 8px; font-size: 0.875em; }
        .btn-icon { background: none; border: none; cursor: pointer; padding: 4px; }
        .tabs { display: flex; border-bottom: 1px solid #ddd; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; }
        .tab-btn.active { background: #f8f9fa; border-bottom: 2px solid #007bff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { border: 1px solid #ddd; border-radius: 5px; padding: 20px; margin: 20px 0; }
        .card-header { margin-bottom: 15px; }
        .card-title { margin: 0; }
        .flex { display: flex; }
        .gap-2 { gap: 8px; }
        .text-sm { font-size: 0.875em; }
        .text-muted { color: #6c757d; }
        .monospace { font-family: monospace; }
        .font-bold { font-weight: bold; }
        .search-input { padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; }
        .w-full { width: 100%; }
        .hidden { display: none; }
        .mt-4 { margin-top: 16px; }
        .mb-2 { margin-bottom: 8px; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 20px 0; }
        .value { font-size: 2em; font-weight: bold; color: #007bff; }
        .label { color: #6c757d; margin-top: 5px; }
        .page-header { margin-bottom: 30px; }
        .page-title { margin: 0; color: #333; }
        .page-subtitle { margin: 5px 0 0 0; color: #6c757d; }
        .page-actions { margin-top: 15px; }
        .table-container { overflow-x: auto; }
        .card-advanced { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 5px; }
        .btn-link { background: none; border: none; color: #007bff; cursor: pointer; text-decoration: underline; }
        .row-details { background: #f8f9fa; }
        .row-details.hidden { display: none; }
        .data-row { }
    </style>
</head>
<body>
    <div class="page-header">
        <h1 class="page-title">Network Services</h1>
        <p class="page-subtitle">Manage interfaces, DHCP, DNS, and routing</p>
        <div class="page-actions">
            <button class="btn btn-secondary btn-sm" onclick="restartNetworking()">
                Restart Networking
            </button>
            <button class="btn btn-primary btn-sm" onclick="showAddInterfaceModal()">
                Add Interface
            </button>
        </div>
    </div>

    <!-- Network Status Stats -->
    <div class="stat-grid">
        <div class="stat-card success">
            <h3>Interfaces</h3>
            <div class="value">{{ interfaces.len() }}</div>
            <div class="label">Active network interfaces</div>
        </div>

        <div class="stat-card info">
            <h3>DHCP Leases</h3>
            <div class="value">{{ dhcp_leases.len() }}</div>
            <div class="label">Active leases</div>
        </div>

        <div class="stat-card warning">
            <h3>DNS Records</h3>
            <div class="value">{{ dns_records.len() }}</div>
            <div class="label">Local DNS entries</div>
        </div>

        <div class="stat-card danger">
            <h3>Routes</h3>
            <div class="value">{{ routes.len() }}</div>
            <div class="label">Routing table entries</div>
        </div>
    </div>

    <!-- Network Service Tabs -->
    <div class="card">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(event, 'interfaces-tab')">
                Interfaces
            </button>
            <button class="tab-btn" onclick="switchTab(event, 'dhcp-tab')">
                DHCP Server
            </button>
            <button class="tab-btn" onclick="switchTab(event, 'dns-tab')">
                DNS Resolver
            </button>
            <button class="tab-btn" onclick="switchTab(event, 'routing-tab')">
                Routing
            </button>
        </div>

        <!-- Interfaces Tab -->
        <div id="interfaces-tab" class="tab-content active">
            <div class="card-header">
                <h2 class="card-title">Network Interfaces</h2>
                <div class="flex gap-2">
                    <input type="search" placeholder="Search interfaces..." class="search-input"
                           oninput="filterTable(this.value, 'interfaces-table')">
                </div>
            </div>

            <div class="table-container">
                <table id="interfaces-table">
                    <thead>
                        <tr>
                            <th>Interface</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>IP Address</th>
                            <th>MAC Address</th>
                            <th>Speed</th>
                            <th>MTU</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for iface in interfaces %}
                        <tr class="data-row">
                            <td><strong>{{ iface.name }}</strong></td>
                            <td>
                                <span class="badge info">{{ iface.interface_type }}</span>
                            </td>
                            <td>
                                {% if iface.enabled %}
                                <span class="badge success">UP</span>
                                {% else %}
                                <span class="badge danger">DOWN</span>
                                {% endif %}
                            </td>
                            <td class="text-sm">{{ iface.ip_display }}</td>
                            <td class="text-sm monospace">{{ iface.mac_display }}</td>
                            <td class="text-sm">{{ iface.speed_display }}</td>
                            <td class="text-sm">{{ iface.mtu }}</td>
                            <td>
                                <button class="btn-icon" onclick="editInterface('{{ iface.name }}')">‚úé</button>
                                <button class="btn-icon" onclick="toggleInterface('{{ iface.name }}', {{ iface.enabled }})">‚èØ</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- DHCP Server Tab -->
        <div id="dhcp-tab" class="tab-content">
            <div class="card-header">
                <h2 class="card-title">DHCP Server</h2>
                <div class="flex gap-2">
                    <input type="search" placeholder="Search leases..." class="search-input"
                           oninput="filterTable(this.value, 'dhcp-table')">
                    <button class="btn btn-sm btn-primary" onclick="showAddDHCPPoolModal()">
                        Add Pool
                    </button>
                </div>
            </div>

            <!-- DHCP Pools -->
            <div style="margin-bottom: 2rem;">
                <h3 class="font-bold mb-2">DHCP Pools</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Interface</th>
                                <th>Pool Range</th>
                                <th>Subnet</th>
                                <th>Gateway</th>
                                <th>Lease Time</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for pool in dhcp_pools %}
                            <tr>
                                <td><strong>{{ pool.interface }}</strong></td>
                                <td class="text-sm">{{ pool.range_start }} - {{ pool.range_end }}</td>
                                <td class="text-sm">{{ pool.subnet }}</td>
                                <td class="text-sm">{{ pool.gateway }}</td>
                                <td class="text-sm">{{ pool.lease_time }}</td>
                                <td>
                                    {% if pool.enabled %}
                                    <span class="badge success">Active</span>
                                    {% else %}
                                    <span class="badge danger">Disabled</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <button class="btn-icon" onclick="editDHCPPool('{{ pool.interface }}')">‚úé</button>
                                    <button class="btn-icon" onclick="deleteDHCPPool('{{ pool.interface }}')">üóë</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Active Leases -->
            <h3 class="font-bold mb-2">Active Leases</h3>
            <div class="table-container">
                <table id="dhcp-table">
                    <thead>
                        <tr>
                            <th>IP Address</th>
                            <th>MAC Address</th>
                            <th>Hostname</th>
                            <th>Lease Start</th>
                            <th>Lease End</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for lease in dhcp_leases %}
                        <tr class="data-row">
                            <td><strong>{{ lease.ip_address }}</strong></td>
                            <td class="text-sm monospace">{{ lease.mac_address }}</td>
                            <td class="text-sm">{{ lease.hostname_display }}</td>
                            <td class="text-sm">{{ lease.lease_start }}</td>
                            <td class="text-sm">{{ lease.lease_end }}</td>
                            <td>
                                {% if lease.is_active %}
                                <span class="badge success">Active</span>
                                {% else %}
                                <span class="badge warning">Expired</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="btn btn-sm btn-secondary" onclick="makeStatic('{{ lease.ip_address }}', '{{ lease.mac_address }}')">
                                    Make Static
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="revokeLease('{{ lease.ip_address }}')">
                                    Revoke
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- DNS Resolver Tab -->
        <div id="dns-tab" class="tab-content">
            <div class="card-header">
                <h2 class="card-title">DNS Resolver</h2>
                <div class="flex gap-2">
                    <button class="btn btn-sm btn-secondary" onclick="flushDNSCache()">
                        Flush Cache
                    </button>
                    <button class="btn btn-sm btn-primary" onclick="showAddDNSRecordModal()">
                        Add Record
                    </button>
                </div>
            </div>

            <!-- DNS Records -->
            <h3 class="font-bold mb-2">Local DNS Records</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Hostname</th>
                            <th>Type</th>
                            <th>Value</th>
                            <th>TTL</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in dns_records %}
                        <tr>
                            <td><strong>{{ record.hostname }}</strong></td>
                            <td><span class="badge info">{{ record.record_type }}</span></td>
                            <td class="text-sm">{{ record.value }}</td>
                            <td class="text-sm">{{ record.ttl }}s</td>
                            <td>
                                <button class="btn-icon" onclick="editDNSRecord('{{ record.hostname }}')">‚úé</button>
                                <button class="btn-icon" onclick="deleteDNSRecord('{{ record.hostname }}')">üóë</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Routing Tab -->
        <div id="routing-tab" class="tab-content">
            <div class="card-header">
                <h2 class="card-title">Routing Table</h2>
                <div class="flex gap-2">
                    <input type="search" placeholder="Search routes..." class="search-input"
                           oninput="filterTable(this.value, 'routing-table')">
                    <button class="btn btn-sm btn-primary" onclick="showAddRouteModal()">
                        Add Route
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="routing-table">
                    <thead>
                        <tr>
                            <th>Destination</th>
                            <th>Gateway</th>
                            <th>Interface</th>
                            <th>Metric</th>
                            <th>Type</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for route in routes %}
                        <tr class="data-row">
                            <td><strong>{{ route.destination }}</strong></td>
                            <td class="text-sm">{{ route.gateway }}</td>
                            <td class="text-sm">{{ route.interface }}</td>
                            <td class="text-sm">{{ route.metric }}</td>
                            <td>
                                {% if route.is_static %}
                                <span class="badge info">Static</span>
                                {% else %}
                                <span class="badge warning">Dynamic</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if route.is_active %}
                                <span class="badge success">Active</span>
                                {% else %}
                                <span class="badge danger">Inactive</span>
                                {% endif %}
                            </td>
                            <td>
                                <button class="btn-icon" onclick="editRoute('{{ route.destination }}')">‚úé</button>
                                <button class="btn-icon" onclick="deleteRoute('{{ route.destination }}')">üóë</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Tab switching
        function switchTab(event, tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // Filter table
        function filterTable(query, tableId) {
            const table = document.getElementById(tableId);
            if (!table) return;

            const rows = table.querySelectorAll('tbody tr.data-row');
            query = query.toLowerCase();

            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                if (text.includes(query)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Interface management
        function editInterface(name) {
            alert(`Configure interface: ${name}`);
        }

        function toggleInterface(name, isUp) {
            const action = isUp ? 'down' : 'up';
            if (confirm(`Bring interface "${name}" ${action}?`)) {
                alert(`Interface ${name} is now ${action}`);
            }
        }

        // DHCP management
        function editDHCPPool(iface) {
            alert(`Edit DHCP pool for ${iface}`);
        }

        function deleteDHCPPool(iface) {
            if (confirm(`Delete DHCP pool for ${iface}?`)) {
                alert(`Deleting pool...`);
            }
        }

        function makeStatic(ip, mac) {
            alert(`Creating static mapping: ${ip} ‚Üí ${mac}`);
        }

        function revokeLease(ip) {
            if (confirm(`Revoke DHCP lease for ${ip}?`)) {
                alert(`Revoking lease...`);
            }
        }

        // DNS management
        function flushDNSCache() {
            if (confirm('Flush DNS cache?')) {
                alert('DNS cache flushed');
            }
        }

        function editDNSRecord(hostname) {
            alert(`Edit DNS record: ${hostname}`);
        }

        function deleteDNSRecord(hostname) {
            if (confirm(`Delete DNS record for ${hostname}?`)) {
                alert(`Deleting record...`);
            }
        }

        // Routing management
        function editRoute(dest) {
            alert(`Edit route: ${dest}`);
        }

        function deleteRoute(dest) {
            if (confirm(`Delete route to ${dest}?`)) {
                alert(`Deleting route...`);
            }
        }

        // Modals
        function restartNetworking() {
            if (confirm('Restart networking?')) {
                alert('Restarting networking...');
            }
        }

        function showAddInterfaceModal() {
            alert('Add Interface modal - TODO');
        }

        function showAddDHCPPoolModal() {
            alert('Add DHCP Pool modal - TODO');
        }

        function showAddDNSRecordModal() {
            alert('Add DNS Record modal - TODO');
        }

        function showAddRouteModal() {
            alert('Add Route modal - TODO');
        }
    </script>
</body>
</html>