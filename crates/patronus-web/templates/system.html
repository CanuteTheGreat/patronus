{% extends "base.html" %}

{% block title %}System - Patronus Firewall{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">System Settings</h1>
    <p class="page-subtitle">Configure system parameters, users, backups, and updates</p>
    <div class="page-actions">
        <button class="btn btn-secondary btn-sm" onclick="createBackup()">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
            </svg>
            Create Backup
        </button>
        <button class="btn btn-primary btn-sm" onclick="checkUpdates()">
            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            Check for Updates
        </button>
    </div>
</div>

<!-- System Status Stats -->
<div class="stat-grid">
    <div class="stat-card success">
        <h3>System Health</h3>
        <div class="value">{{ system_health }}/100</div>
        <div class="label">All services running</div>
    </div>

    <div class="stat-card info">
        <h3>Uptime</h3>
        <div class="value">{{ uptime_days }}d</div>
        <div class="label">{{ uptime }}</div>
    </div>

    <div class="stat-card warning">
        <h3>Disk Usage</h3>
        <div class="value">{{ disk_usage_percent }}%</div>
        <div class="label">{{ disk_used }} / {{ disk_total }}</div>
    </div>

    <div class="stat-card danger">
        <h3>Updates Available</h3>
        <div class="value">{{ updates_available }}</div>
        <div class="label">{{ security_updates }} security updates</div>
    </div>
</div>

<!-- System Tabs -->
<div class="card">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(event, 'general-tab')">
            General
        </button>
        <button class="tab-btn" onclick="switchTab(event, 'users-tab')">
            Users & Access
        </button>
        <button class="tab-btn" onclick="switchTab(event, 'backup-tab')">
            Backup & Restore
        </button>
        <button class="tab-btn" onclick="switchTab(event, 'updates-tab')">
            Updates
        </button>
        <button class="tab-btn" onclick="switchTab(event, 'services-tab')">
            Services
        </button>
    </div>

    <!-- General Settings Tab -->
    <div id="general-tab" class="tab-content active">
        <div class="card-header">
            <h2 class="card-title">General System Settings</h2>
        </div>

        <div style="display: grid; gap: 2rem;">
            <!-- System Identity -->
            <div>
                <h3 class="font-bold mb-3">System Identity</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div>
                        <label class="block text-sm font-bold mb-1">Hostname</label>
                        <input type="text" class="w-full" value="{{ hostname }}">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">Domain</label>
                        <input type="text" class="w-full" value="{{ domain }}">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">Timezone</label>
                        <select class="w-full">
                            <option selected>{{ timezone }}</option>
                            <option>UTC</option>
                            <option>America/New_York</option>
                            <option>Europe/London</option>
                            <option>Asia/Tokyo</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">Language</label>
                        <select class="w-full">
                            <option selected>English</option>
                            <option>Spanish</option>
                            <option>French</option>
                            <option>German</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Web Interface -->
            <div>
                <h3 class="font-bold mb-3">Web Interface</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                    <div>
                        <label class="block text-sm font-bold mb-1">HTTPS Port</label>
                        <input type="number" class="w-full" value="8443">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">Session Timeout</label>
                        <input type="number" class="w-full" value="3600" placeholder="seconds">
                    </div>
                    <div>
                        <label>
                            <input type="checkbox" checked> Require HTTPS
                        </label>
                    </div>
                    <div>
                        <label>
                            <input type="checkbox" checked> Enable 2FA
                        </label>
                    </div>
                </div>
            </div>

            <!-- System Information -->
            <div>
                <h3 class="font-bold mb-3">System Information</h3>
                <table>
                    <tr>
                        <td><strong>Version</strong></td>
                        <td>{{ version }}</td>
                    </tr>
                    <tr>
                        <td><strong>Kernel</strong></td>
                        <td>{{ kernel_version }}</td>
                    </tr>
                    <tr>
                        <td><strong>Architecture</strong></td>
                        <td>{{ arch }}</td>
                    </tr>
                    <tr>
                        <td><strong>CPU</strong></td>
                        <td>{{ cpu_model }} ({{ cpu_cores }} cores)</td>
                    </tr>
                    <tr>
                        <td><strong>Memory</strong></td>
                        <td>{{ memory_total }}</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="card-advanced hidden">
            <h3 class="mb-2 font-bold">Advanced System Settings</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                    <label class="block text-sm font-bold mb-1">Shell Access</label>
                    <select class="w-full">
                        <option>Disabled</option>
                        <option selected>SSH Only</option>
                        <option>Serial Console Only</option>
                        <option>Both</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Serial Console Baud Rate</label>
                    <input type="number" class="w-full" value="115200">
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Enable Hardware Watchdog
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Enable Kernel Crash Dumps
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Automatic Security Updates
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Enable Swap
                    </label>
                </div>
            </div>
            <div class="mt-4">
                <h4 class="font-bold mb-2">Power Management</h4>
                <div style="display: grid; gap: 1rem;">
                    <label>
                        <input type="checkbox"> Enable CPU Frequency Scaling
                    </label>
                    <label>
                        <input type="checkbox" checked> Disable USB Autosuspend
                    </label>
                </div>
            </div>
        </div>
        <button class="btn btn-link mt-4" onclick="toggleAdvanced(this)">Advanced Settings ▼</button>

        <div class="flex gap-2 mt-4">
            <button class="btn btn-primary">Save Settings</button>
            <button class="btn btn-secondary">Reset to Defaults</button>
        </div>
    </div>

    <!-- Users & Access Tab -->
    <div id="users-tab" class="tab-content">
        <div class="card-header">
            <h2 class="card-title">User Management</h2>
            <button class="btn btn-sm btn-primary" onclick="showAddUserModal()">
                Add User
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Full Name</th>
                        <th>Role</th>
                        <th>2FA Enabled</th>
                        <th>Last Login</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td><strong>{{ user.username }}</strong></td>
                        <td class="text-sm">{{ user.full_name }}</td>
                        <td>
                            {% if user.role == "admin" %}
                            <span class="badge danger">Administrator</span>
                            {% else %}
                            <span class="badge info">User</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if user.two_factor_enabled %}
                            <span class="badge success">Enabled</span>
                            {% else %}
                            <span class="badge warning">Disabled</span>
                            {% endif %}
                        </td>
                        <td class="text-sm">{{ user.last_login.as_ref().unwrap_or(&"Never".to_string()) }}</td>
                        <td>
                            {% if user.is_active %}
                            <span class="badge success">Active</span>
                            {% else %}
                            <span class="badge danger">Disabled</span>
                            {% endif %}
                        </td>
                        <td>
                            <button class="btn-icon" onclick="editUser('{{ user.username }}')">✎</button>
                            {% if !user.is_system_user %}
                            <button class="btn-icon" onclick="deleteUser('{{ user.username }}')">🗑</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Active Sessions -->
        <div style="margin-top: 2rem;">
            <h3 class="font-bold mb-3">Active Sessions</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>IP Address</th>
                            <th>Login Time</th>
                            <th>User Agent</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for session in active_sessions %}
                        <tr>
                            <td><strong>{{ session.username }}</strong></td>
                            <td class="text-sm monospace">{{ session.ip_address }}</td>
                            <td class="text-sm">{{ session.login_time }}</td>
                            <td class="text-sm">{{ session.user_agent[0..50] }}...</td>
                            <td>
                                <button class="btn btn-sm btn-danger" onclick="terminateSession('{{ session.id }}')">
                                    Terminate
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-advanced hidden">
            <h3 class="mb-2 font-bold">Access Control Settings</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                    <label class="block text-sm font-bold mb-1">Password Policy</label>
                    <select class="w-full">
                        <option>Weak (8 chars)</option>
                        <option selected>Medium (12 chars, mixed case)</option>
                        <option>Strong (16 chars, mixed + symbols)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Session Timeout</label>
                    <input type="number" class="w-full" value="3600" placeholder="seconds">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Max Login Attempts</label>
                    <input type="number" class="w-full" value="5">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Lockout Duration</label>
                    <input type="number" class="w-full" value="900" placeholder="seconds">
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Require 2FA for Admins
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Allow API Key Authentication
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Log All Login Attempts
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Enable SSO (SAML/OAuth)
                    </label>
                </div>
            </div>
            <div class="mt-4">
                <h4 class="font-bold mb-2">IP Access Restrictions</h4>
                <textarea rows="4" class="w-full" placeholder="192.168.1.0/24&#10;10.0.0.0/8"></textarea>
            </div>
            <div class="flex gap-2 mt-4">
                <button class="btn btn-primary btn-sm">Save Settings</button>
            </div>
        </div>
        <button class="btn btn-link mt-4" onclick="toggleAdvanced(this)">Advanced Settings ▼</button>
    </div>

    <!-- Backup & Restore Tab -->
    <div id="backup-tab" class="tab-content">
        <div class="card-header">
            <h2 class="card-title">Backup & Restore</h2>
            <div class="flex gap-2">
                <button class="btn btn-sm btn-secondary" onclick="showRestoreModal()">
                    Restore from Backup
                </button>
                <button class="btn btn-sm btn-primary" onclick="createBackup()">
                    Create Backup Now
                </button>
            </div>
        </div>

        <!-- Recent Backups -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Backup Name</th>
                        <th>Created</th>
                        <th>Size</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for backup in backups %}
                    <tr>
                        <td><strong>{{ backup.name }}</strong></td>
                        <td class="text-sm">{{ backup.created_at }}</td>
                        <td class="text-sm">{{ backup.size }}</td>
                        <td>
                            {% if backup.backup_type == "full" %}
                            <span class="badge info">Full</span>
                            {% else %}
                            <span class="badge">Config Only</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if backup.is_valid %}
                            <span class="badge success">Valid</span>
                            {% else %}
                            <span class="badge danger">Corrupted</span>
                            {% endif %}
                        </td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick="downloadBackup('{{ backup.id }}')">
                                Download
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="restoreBackup('{{ backup.id }}')">
                                Restore
                            </button>
                            <button class="btn-icon" onclick="deleteBackup('{{ backup.id }}')">🗑</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="card-advanced hidden">
            <h3 class="mb-2 font-bold">Automatic Backup Configuration</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                    <label class="block text-sm font-bold mb-1">Backup Schedule</label>
                    <select class="w-full">
                        <option>Disabled</option>
                        <option selected>Daily @ 3:00 AM</option>
                        <option>Weekly on Sunday</option>
                        <option>Monthly on 1st</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Retention Policy</label>
                    <select class="w-full">
                        <option>7 days</option>
                        <option selected>30 days</option>
                        <option>90 days</option>
                        <option>Keep all</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Backup Location</label>
                    <select class="w-full">
                        <option selected>Local Storage</option>
                        <option>Network Share (SMB/NFS)</option>
                        <option>S3-Compatible Storage</option>
                        <option>SFTP Server</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Compression</label>
                    <select class="w-full">
                        <option>None</option>
                        <option selected>gzip</option>
                        <option>bzip2</option>
                        <option>xz</option>
                    </select>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Include Configuration
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Include Logs
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Encrypt Backups (AES-256)
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Verify After Backup
                    </label>
                </div>
            </div>
            <div class="mt-4">
                <h4 class="font-bold mb-2">Remote Backup Settings</h4>
                <div style="display: grid; gap: 1rem;">
                    <div>
                        <label class="block text-sm font-bold mb-1">Remote URL</label>
                        <input type="text" class="w-full" placeholder="s3://bucket/path or sftp://server/path">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-1">Credentials</label>
                        <input type="password" class="w-full" placeholder="Access key or password">
                    </div>
                </div>
            </div>
            <div class="flex gap-2 mt-4">
                <button class="btn btn-primary btn-sm">Save Configuration</button>
                <button class="btn btn-secondary btn-sm">Test Backup Now</button>
            </div>
        </div>
        <button class="btn btn-link mt-4" onclick="toggleAdvanced(this)">Backup Settings ▼</button>
    </div>

    <!-- Updates Tab -->
    <div id="updates-tab" class="tab-content">
        <div class="card-header">
            <h2 class="card-title">System Updates</h2>
            <button class="btn btn-sm btn-primary" onclick="checkUpdates()">
                Check for Updates
            </button>
        </div>

        {% if updates_available > 0 %}
        <div class="alert alert-warning" style="margin-bottom: 1.5rem;">
            <strong>{{ updates_available }} updates available</strong> ({{ security_updates }} security updates)
            <button class="btn btn-sm btn-primary mt-2" onclick="installAllUpdates()">Install All Updates</button>
        </div>
        {% endif %}

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Package</th>
                        <th>Current Version</th>
                        <th>New Version</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for update in available_updates %}
                    <tr>
                        <td><strong>{{ update.package_name }}</strong></td>
                        <td class="text-sm">{{ update.current_version }}</td>
                        <td class="text-sm">{{ update.new_version }}</td>
                        <td>
                            {% if update.is_security %}
                            <span class="badge danger">Security</span>
                            {% else %}
                            <span class="badge info">Regular</span>
                            {% endif %}
                        </td>
                        <td class="text-sm">{{ update.size }}</td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="installUpdate('{{ update.package_name }}')">
                                Install
                            </button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Update History -->
        <div style="margin-top: 2rem;">
            <h3 class="font-bold mb-3">Update History</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Package</th>
                            <th>Version</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for history in update_history %}
                        <tr>
                            <td class="text-sm">{{ history.installed_at }}</td>
                            <td><strong>{{ history.package_name }}</strong></td>
                            <td class="text-sm">{{ history.version }}</td>
                            <td>
                                {% if history.status == "success" %}
                                <span class="badge success">Installed</span>
                                {% else %}
                                <span class="badge danger">Failed</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="card-advanced hidden">
            <h3 class="mb-2 font-bold">Update Settings</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                    <label class="block text-sm font-bold mb-1">Update Channel</label>
                    <select class="w-full">
                        <option selected>Stable</option>
                        <option>Beta</option>
                        <option>Development</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-1">Check Frequency</label>
                    <select class="w-full">
                        <option>Hourly</option>
                        <option selected>Daily</option>
                        <option>Weekly</option>
                        <option>Never</option>
                    </select>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Auto-install Security Updates
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Auto-install All Updates
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Create Backup Before Update
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Email Notification on Updates
                    </label>
                </div>
            </div>
            <div class="flex gap-2 mt-4">
                <button class="btn btn-primary btn-sm">Save Settings</button>
            </div>
        </div>
        <button class="btn btn-link mt-4" onclick="toggleAdvanced(this)">Update Settings ▼</button>
    </div>

    <!-- Services Tab -->
    <div id="services-tab" class="tab-content">
        <div class="card-header">
            <h2 class="card-title">System Services</h2>
            <button class="btn btn-sm btn-secondary" onclick="restartAllServices()">
                Restart All Services
            </button>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Service</th>
                        <th>Status</th>
                        <th>Uptime</th>
                        <th>Auto-start</th>
                        <th>Memory</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for service in services %}
                    <tr>
                        <td><strong>{{ service.name }}</strong></td>
                        <td>
                            {% if service.is_running %}
                            <span class="badge success">Running</span>
                            {% else %}
                            <span class="badge danger">Stopped</span>
                            {% endif %}
                        </td>
                        <td class="text-sm">{{ service.uptime.as_ref().unwrap_or(&"N/A".to_string()) }}</td>
                        <td>
                            {% if service.enabled %}
                            <span class="badge success">Enabled</span>
                            {% else %}
                            <span class="badge">Disabled</span>
                            {% endif %}
                        </td>
                        <td class="text-sm">{{ service.memory_usage.as_ref().unwrap_or(&"N/A".to_string()) }}</td>
                        <td>
                            {% if service.is_running %}
                            <button class="btn btn-sm btn-warning" onclick="restartService('{{ service.name }}')">
                                Restart
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="stopService('{{ service.name }}')">
                                Stop
                            </button>
                            {% else %}
                            <button class="btn btn-sm btn-success" onclick="startService('{{ service.name }}')">
                                Start
                            </button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="card-advanced hidden">
            <h3 class="mb-2 font-bold">Service Management</h3>
            <div style="display: grid; gap: 1rem;">
                <div>
                    <label>
                        <input type="checkbox" checked> Auto-restart Failed Services
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox" checked> Send Alerts on Service Failures
                    </label>
                </div>
                <div>
                    <label>
                        <input type="checkbox"> Enable Service Watchdog
                    </label>
                </div>
            </div>
            <div class="mt-4">
                <h4 class="font-bold mb-2">Service Limits</h4>
                <p class="text-sm text-muted mb-2">Configure resource limits for services (systemd units)</p>
                <button class="btn btn-secondary btn-sm">Configure Limits</button>
            </div>
        </div>
        <button class="btn btn-link mt-4" onclick="toggleAdvanced(this)">Advanced Settings ▼</button>
    </div>
</div>

<!-- Danger Zone -->
<div class="card" style="border: 2px solid var(--danger); margin-top: 2rem;">
    <div class="card-header" style="background: var(--danger); color: white;">
        <h2 class="card-title">⚠️ Danger Zone</h2>
    </div>

    <div style="padding: 1.5rem;">
        <div style="display: grid; gap: 1rem;">
            <div>
                <h4 class="font-bold">Restart System</h4>
                <p class="text-sm text-muted mb-2">Reboot the firewall. All connections will be temporarily interrupted.</p>
                <button class="btn btn-warning" onclick="rebootSystem()">Reboot System</button>
            </div>

            <div>
                <h4 class="font-bold">Shutdown System</h4>
                <p class="text-sm text-muted mb-2">Power off the firewall. You will need physical access to power it back on.</p>
                <button class="btn btn-warning" onclick="shutdownSystem()">Shutdown System</button>
            </div>

            <div>
                <h4 class="font-bold">Factory Reset</h4>
                <p class="text-sm text-muted mb-2">Reset all configuration to factory defaults. This action cannot be undone!</p>
                <button class="btn btn-danger" onclick="factoryReset()">Factory Reset</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
// Tab switching
function switchTab(event, tabId) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    document.getElementById(tabId).classList.add('active');
    event.target.classList.add('active');
}

// User management
function editUser(username) {
    alert(`Edit user: ${username}`);
    // TODO: Show edit modal
}

function deleteUser(username) {
    if (confirm(`Delete user "${username}"? This cannot be undone.`)) {
        alert(`Deleting user ${username}...`);
        // TODO: API call
    }
}

function terminateSession(id) {
    if (confirm('Terminate this session?')) {
        alert(`Terminating session ${id}...`);
        // TODO: API call
    }
}

function showAddUserModal() {
    alert('Add User modal - TODO');
}

// Backup management
function createBackup() {
    if (confirm('Create a backup now? This may take a few minutes.')) {
        alert('Creating backup...');
        // TODO: API call with progress
    }
}

function downloadBackup(id) {
    alert(`Downloading backup ${id}...`);
    // TODO: Download file
}

function restoreBackup(id) {
    if (confirm('Restore from this backup? The system will reboot after restoration.')) {
        alert(`Restoring from backup ${id}...`);
        // TODO: API call
    }
}

function deleteBackup(id) {
    if (confirm('Delete this backup?')) {
        alert(`Deleting backup ${id}...`);
        // TODO: API call
    }
}

function showRestoreModal() {
    alert('Restore from uploaded backup - TODO');
}

// Updates
function checkUpdates() {
    alert('Checking for updates...');
    // TODO: API call
}

function installUpdate(pkg) {
    if (confirm(`Install update for ${pkg}?`)) {
        alert(`Installing ${pkg}...`);
        // TODO: API call with progress
    }
}

function installAllUpdates() {
    if (confirm('Install all available updates? The system may need to reboot.')) {
        alert('Installing all updates...');
        // TODO: API call with progress
    }
}

// Services
function startService(name) {
    alert(`Starting ${name}...`);
    // TODO: API call
}

function stopService(name) {
    if (confirm(`Stop ${name} service?`)) {
        alert(`Stopping ${name}...`);
        // TODO: API call
    }
}

function restartService(name) {
    if (confirm(`Restart ${name} service?`)) {
        alert(`Restarting ${name}...`);
        // TODO: API call
    }
}

function restartAllServices() {
    if (confirm('Restart all services? This may briefly interrupt connectivity.')) {
        alert('Restarting all services...');
        // TODO: API call
    }
}

// Danger zone
function rebootSystem() {
    const confirmed = prompt('Type "REBOOT" to confirm system reboot:');
    if (confirmed === 'REBOOT') {
        alert('Rebooting system in 10 seconds...');
        // TODO: API call
    }
}

function shutdownSystem() {
    const confirmed = prompt('Type "SHUTDOWN" to confirm system shutdown:');
    if (confirmed === 'SHUTDOWN') {
        alert('Shutting down system in 10 seconds...');
        // TODO: API call
    }
}

function factoryReset() {
    const confirmed = prompt('Type "FACTORY RESET" to confirm. THIS CANNOT BE UNDONE:');
    if (confirmed === 'FACTORY RESET') {
        alert('Performing factory reset...');
        // TODO: API call
    }
}
</script>
{% endblock %}
