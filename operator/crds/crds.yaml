---
# Site CRD
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: sites.sdwan.patronus.dev
spec:
  group: sdwan.patronus.dev
  names:
    categories: []
    kind: Site
    plural: sites
    shortNames:
    - site
    singular: site
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.peers
      name: Peers
      type: integer
    - jsonPath: .status.activePaths
      name: Paths
      type: integer
    - jsonPath: .status.healthScore
      name: Health
      type: number
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for SiteSpec via `CustomResource`
        properties:
          spec:
            description: Site Custom Resource
            properties:
              location:
                description: Physical location of the site
                nullable: true
                type: string
              mesh:
                description: Mesh networking configuration
                nullable: true
                properties:
                  enabled:
                    default: false
                    description: Enable mesh networking
                    type: boolean
                  peer_with:
                    description: Sites to peer with
                    items:
                      type: string
                    type: array
                type: object
              resources:
                description: Resource requests
                nullable: true
                properties:
                  cpu:
                    description: CPU request (e.g., "2" or "2000m")
                    nullable: true
                    type: string
                  memory:
                    description: Memory request (e.g., "4Gi")
                    nullable: true
                    type: string
                  storage:
                    description: Storage request (e.g., "10Gi")
                    nullable: true
                    type: string
                type: object
              wireguard:
                description: WireGuard configuration
                properties:
                  endpoints:
                    description: Endpoints (IP:port)
                    items:
                      type: string
                    type: array
                  listen_port:
                    description: Listen port (1-65535)
                    format: uint16
                    minimum: 0.0
                    type: integer
                  public_key:
                    description: WireGuard public key (44 characters, base64 encoded)
                    type: string
                required:
                - endpoints
                - listen_port
                - public_key
                type: object
            required:
            - wireguard
            type: object
          status:
            description: Site status
            nullable: true
            properties:
              active_paths:
                description: Number of active paths
                format: int32
                nullable: true
                type: integer
              conditions:
                description: Conditions
                items:
                  description: Site condition
                  properties:
                    last_transition_time:
                      description: Last transition time
                      nullable: true
                      type: string
                    message:
                      description: Message
                      nullable: true
                      type: string
                    reason:
                      description: Reason
                      nullable: true
                      type: string
                    status:
                      description: Status
                      enum:
                      - 'True'
                      - 'False'
                      - Unknown
                      type: string
                    type:
                      description: Condition type
                      type: string
                  required:
                  - status
                  - type
                  type: object
                type: array
              health_score:
                description: Health score (0-100)
                format: double
                nullable: true
                type: number
              peers:
                description: Number of peers
                format: int32
                nullable: true
                type: integer
              phase:
                description: Current phase
                enum:
                - Pending
                - Active
                - Failed
                - Terminating
                nullable: true
                type: string
            type: object
        required:
        - spec
        title: Site
        type: object
    served: true
    storage: true
    subresources:
      status: {}

---
# Policy CRD
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: policies.sdwan.patronus.dev
spec:
  group: sdwan.patronus.dev
  names:
    categories: []
    kind: Policy
    plural: policies
    shortNames:
    - pol
    singular: policy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.priority
      name: Priority
      type: integer
    - jsonPath: .status.active
      name: Active
      type: boolean
    - jsonPath: .status.matchedFlows
      name: Flows
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for PolicySpec via `CustomResource`
        properties:
          spec:
            description: Policy Custom Resource
            properties:
              action:
                description: Action to take
                properties:
                  backup_path:
                    description: Backup path
                    nullable: true
                    properties:
                      path_id:
                        description: Path ID
                        type: string
                      site_ref:
                        description: Site name
                        type: string
                    required:
                    - path_id
                    - site_ref
                    type: object
                  primary_path:
                    description: Primary path
                    nullable: true
                    properties:
                      path_id:
                        description: Path ID
                        type: string
                      site_ref:
                        description: Site name
                        type: string
                    required:
                    - path_id
                    - site_ref
                    type: object
                  qos:
                    description: QoS configuration
                    nullable: true
                    properties:
                      bandwidth:
                        description: Bandwidth limit (e.g., "10Mbps", "1Gbps")
                        nullable: true
                        type: string
                      class:
                        description: QoS class
                        enum:
                        - realtime
                        - business-critical
                        - best-effort
                        type: string
                    required:
                    - class
                    type: object
                  type:
                    description: Action type
                    enum:
                    - route
                    - drop
                    - forward
                    type: string
                required:
                - type
                type: object
              failover:
                description: Failover configuration
                nullable: true
                properties:
                  cooldown:
                    description: Cooldown period (e.g., "30s", "1m")
                    type: string
                  threshold:
                    description: Health threshold for failover (0-100)
                    format: int32
                    maximum: 100.0
                    minimum: 0.0
                    type: integer
                required:
                - cooldown
                - threshold
                type: object
              match:
                description: Match criteria
                properties:
                  dscp:
                    description: DSCP value (0-63)
                    format: int32
                    maximum: 63.0
                    minimum: 0.0
                    nullable: true
                    type: integer
                  dst_port_range:
                    description: Destination port range (e.g., "80", "80-443", "80,443,8080")
                    nullable: true
                    type: string
                  protocol:
                    description: Protocol (tcp, udp, icmp, any)
                    enum:
                    - tcp
                    - udp
                    - icmp
                    - any
                    nullable: true
                    type: string
                  src_port_range:
                    description: Source port range
                    nullable: true
                    type: string
                type: object
              priority:
                description: Policy priority (0-1000, higher = more important)
                format: int32
                maximum: 1000.0
                minimum: 0.0
                type: integer
            required:
            - action
            - match
            - priority
            type: object
          status:
            description: Policy status
            nullable: true
            properties:
              active:
                description: Whether policy is active
                nullable: true
                type: boolean
              bytes_routed:
                description: Total bytes routed
                format: int64
                nullable: true
                type: integer
              matched_flows:
                description: Number of flows matched
                format: int64
                nullable: true
                type: integer
            type: object
        required:
        - spec
        title: Policy
        type: object
    served: true
    storage: true
    subresources:
      status: {}

